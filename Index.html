<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Pulseiras do Condomínio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #495057;
            --accent: #4361ee;
            --accent-hover: #3a56d4;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --success: #2dce89;
            --danger: #f5365c;
            --warning: #fb6340;
            --info: #11cdef;
            --light: #f4f5f7;
            --dark: #32325d;
        }

        [data-theme="dark"] {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-tertiary: #4a5568;
            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e0;
            --accent: #4c6ef5;
            --accent-hover: #3b5bdb;
            --border: #4a5568;
            --shadow: rgba(0, 0, 0, 0.3);
            --light: #2d3748;
            --dark: #1a202c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Estilos da tela de login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-tertiary) 100%);
        }

        .login-card {
            background: var(--bg-secondary);
            border-radius: 15px;
            box-shadow: 0 10px 30px var(--shadow);
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border);
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 15px;
        }

        .login-header h1 {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .login-header p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .login-form input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .login-btn {
            width: 100%;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .login-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .login-error {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        /* Estilos do sistema principal */
        .main-container {
            display: none;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2rem;
            color: var(--accent);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: var(--bg-tertiary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .theme-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
        }

        .logout-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background: #ec0c38;
        }

        /* Correção das abas de navegação */
        .tabs {
            display: flex;
            flex-wrap: nowrap;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .tab {
            flex: 0 0 auto;
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .tab:hover {
            color: var(--accent);
        }

        .tab.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 10px;
            box-shadow: 0 4px 6px var(--shadow);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #ec0c38;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #26af74;
        }

        .btn-info {
            background: var(--info);
        }

        .btn-info:hover {
            background: #0da5c0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .hospedes-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .hospede-field {
            flex: 1;
            min-width: 180px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: var(--bg-tertiary);
        }

        .highlight {
            background: rgba(245, 54, 92, 0.2) !important;
        }

        .hospedes-list {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .hospede-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .hospede-item i {
            color: var(--accent);
            font-size: 0.9rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow);
            border: 1px solid var(--border);
            text-align: center;
        }

        .summary-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .summary-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark);
            color: white;
            padding: 15px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .apartamento-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid var(--border);
        }

        .apartamento-item:last-child {
            border-bottom: none;
        }

        .boleto-upload {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .boleto-upload input[type="file"] {
            display: none;
        }

        .boleto-upload label {
            background: var(--bg-tertiary);
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .boleto-upload span {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            overflow: hidden;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .apartamento-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .apartamento-nome {
            font-weight: 600;
            color: var(--text-primary);
        }

        .apartamento-detalhe {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .hospedes-row {
                flex-direction: column;
            }
            
            .hospede-field {
                min-width: 100%;
            }
            
            .filter-container {
                flex-direction: column;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 1 auto;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div class="login-container" id="login-container">
        <div class="login-card">
            <div class="login-header">
                <i class="fas fa-id-card"></i>
                <h1>Controle de Pulseiras</h1>
                <p>Sistema de Controle do Condomínio</p>
            </div>
            <form class="login-form" id="login-form" onsubmit="return handleLogin(event);">
                <div class="form-group">
                    <label for="username">Usuário</label>
                    <input type="text" id="username" placeholder="Digite seu usuário" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" required>
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    Entrar
                </button>
                <div class="login-error" id="login-error">
                    <i class="fas fa-exclamation-circle"></i>
                    Usuário ou senha incorretos!
                </div>
            </form>
        </div>
    </div>

    <!-- Sistema Principal -->
    <div class="main-container" id="main-container">
        <div class="container">
            <header>
                <div class="logo">
                    <i class="fas fa-id-card"></i>
                    <h1>Controle de Pulseiras do Condomínio</h1>
                </div>
                <div class="user-info">
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="user-type">Administrador</span>
                    </div>
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                        <span>Dark Mode</span>
                    </button>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        Sair
                    </button>
                </div>
            </header>

            <div class="tabs" id="tabs-container">
                <div class="tab active" data-tab="lancamentos">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Lançamentos</span>
                </div>
                <div class="tab admin-tab" data-tab="resumo">
                    <i class="fas fa-chart-pie"></i>
                    <span>Resumo</span>
                </div>
                <div class="tab admin-tab" data-tab="estoque">
                    <i class="fas fa-warehouse"></i>
                    <span>Estoque</span>
                </div>
                <div class="tab admin-tab" data-tab="relatorios">
                    <i class="fas fa-file-pdf"></i>
                    <span>Relatórios</span>
                </div>
                <div class="tab admin-tab" data-tab="config">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </div>
            </div>

            <!-- Aba Lancamentos -->
            <div class="tab-content active" id="lancamentos">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Novo Lançamento</h2>
                    </div>
                    <form id="lancamento-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data e Hora</label>
                                <input type="text" id="data-hora" readonly>
                            </div>
                            <div class="form-group">
                                <label for="apartamento">Apartamento</label>
                                <select id="apartamento" required>
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nomes dos Hóspedes</label>
                            <div class="hospedes-row">
                                <div class="hospede-field">
                                    <input type="text" class="hospede-nome" placeholder="Hóspede 1">
                                </div>
                                <div class="hospede-field">
                                    <input type="text" class="hospede-nome" placeholder="Hóspede 2">
                                </div>
                                <div class="hospede-field">
                                    <input type="text" class="hospede-nome" placeholder="Hóspede 3">
                                </div>
                                <div class="hospede-field">
                                    <input type="text" class="hospede-nome" placeholder="Hóspede 4">
                                </div>
                                <div class="hospede-field">
                                    <input type="text" class="hospede-nome" placeholder="Hóspede 5">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="quantidade">Quantidade de Pulseiras</label>
                                <input type="number" id="quantidade" min="1" readonly>
                            </div>
                            <div class="form-group">
                                <label for="observacoes">Observações</label>
                                <textarea id="observacoes" rows="2"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Salvar Lançamento
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Lançamentos Realizados</h2>
                        <div class="filter-container">
                            <div class="filter-group">
                                <input type="text" id="filter-lancamentos" placeholder="Buscar lançamentos...">
                            </div>
                            <div class="filter-group">
                                <select id="filter-apartamento">
                                    <option value="">Todos Apartamentos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="lancamentos-table">
                            <thead>
                                <tr>
                                    <th>Apartamento</th>
                                    <th>Data</th>
                                    <th>Hora</th>
                                    <th>Hóspedes</th>
                                    <th>Qtd. Pulseiras</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="lancamentos-tbody">
                                <!-- Lançamentos serão inseridos aqui via JavaScript -->
                            </tbody>
                        </table>
                        <div id="lancamentos-empty" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>Nenhum lançamento encontrado</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Resumo -->
            <div class="tab-content admin-content" id="resumo">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Resumo de Consumo</h2>
                        <button class="btn btn-info" id="gerar-relatorio-mes">
                            <i class="fas fa-file-pdf"></i>
                            Gerar Relatório do Mês
                        </button>
                    </div>
                    <div class="filter-container">
                        <div class="filter-group">
                            <label for="periodo">Período</label>
                            <input type="month" id="periodo">
                        </div>
                    </div>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3 id="total-pulseiras">0</h3>
                            <p>Total de Pulseiras</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="total-apartamentos">0</h3>
                            <p>Apartamentos com Consumo</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="valor-total">R$ 0,00</h3>
                            <p>Valor Total</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="custo-medio">R$ 0,00</h3>
                            <p>Custo Médio por Pulseira</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Consumo por Apartamento</h2>
                    </div>
                    <div class="table-container">
                        <table id="resumo-table">
                            <thead>
                                <tr>
                                    <th>Apartamento</th>
                                    <th>Pulseiras no Período</th>
                                    <th>Valor Unitário</th>
                                    <th>Valor a Pagar</th>
                                </tr>
                            </thead>
                            <tbody id="resumo-tbody">
                                <!-- Resumo será inserido aqui via JavaScript -->
                            </tbody>
                        </table>
                        <div id="resumo-empty" class="empty-state">
                            <i class="fas fa-chart-pie"></i>
                            <p>Selecione um período para ver o resumo</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Estoque -->
            <div class="tab-content admin-content" id="estoque">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nova Compra</h2>
                    </div>
                    <form id="compra-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="data-compra">Data da Compra</label>
                                <input type="date" id="data-compra" required>
                            </div>
                            <div class="form-group">
                                <label for="qtd-comprada">Quantidade Comprada</label>
                                <input type="number" id="qtd-comprada" min="1" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="custo-total">Custo Total (R$)</label>
                                <input type="text" id="custo-total" min="0" step="0.01" required>
                            </div>
                            <div class="form-group">
                                <label for="custo-unitario">Custo Unitário (R$)</label>
                                <input type="text" id="custo-unitario" min="0" step="0.01" readonly>
                            </div>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-shopping-cart"></i>
                            Registrar Compra
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Controle de Estoque</h2>
                        <button class="btn btn-info" id="gerar-relatorio-estoque">
                            <i class="fas fa-file-pdf"></i>
                            Gerar Relatório Geral
                        </button>
                    </div>
                    <div class="summary-grid">
                        <div class="summary-card">
                            <h3 id="total-comprado">0</h3>
                            <p>Total Comprado</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="total-entregue">0</h3>
                            <p>Total Entregue</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="saldo-disponivel">0</h3>
                            <p>Disponível</p>
                        </div>
                        <div class="summary-card">
                            <h3 id="custo-medio-estoque">R$ 0,00</h3>
                            <p>Custo Médio</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Histórico de Compras</h2>
                    </div>
                    <div class="table-container">
                        <table id="compras-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Quantidade</th>
                                    <th>Custo Total</th>
                                    <th>Custo Unitário</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="compras-tbody">
                                <!-- Compras serão inseridas aqui via JavaScript -->
                            </tbody>
                        </table>
                        <div id="compras-empty" class="empty-state">
                            <i class="fas fa-shopping-basket"></i>
                            <p>Nenhuma compra registrada</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Relatórios -->
            <div class="tab-content admin-content" id="relatorios">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Gerar Faturas em PDF</h2>
                    </div>
                    <div class="filter-container">
                        <div class="filter-group">
                            <label for="relatorio-periodo">Período</label>
                            <input type="month" id="relatorio-periodo">
                        </div>
                    </div>
                    <button class="btn btn-success" id="gerar-faturas">
                        <i class="fas fa-file-pdf"></i>
                        Gerar Faturas
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Faturas Geradas</h2>
                    </div>
                    <div class="table-container">
                        <table id="faturas-table">
                            <thead>
                                <tr>
                                    <th>Apartamento</th>
                                    <th>Proprietário</th>
                                    <th>CPF</th>
                                    <th>Quantidade</th>
                                    <th>Período</th>
                                    <th>Data de Geração</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="faturas-tbody">
                                <!-- Faturas serão inseridas aqui via JavaScript -->
                            </tbody>
                        </table>
                        <div id="faturas-empty" class="empty-state">
                            <i class="fas fa-file-pdf"></i>
                            <p>Nenhuma fatura gerada</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Config -->
            <div class="tab-content admin-content" id="config">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Dados do Condomínio</h2>
                    </div>
                    <form id="condominio-form">
                        <div class="form-group">
                            <label for="nome-condominio">Nome do Condomínio</label>
                            <input type="text" id="nome-condominio" required>
                        </div>
                        <div class="form-group">
                            <label for="endereco-condominio">Endereço do Condomínio</label>
                            <input type="text" id="endereco-condominio" required>
                        </div>
                        <div class="form-group">
                            <label for="cnpj-condominio">CNPJ do Condomínio</label>
                            <input type="text" id="cnpj-condominio" placeholder="00.000.000/0000-00" required>
                        </div>
                        <button type="submit" class="btn">
                            <i class="fas fa-save"></i>
                            Salvar Dados
                        </button>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Cadastro de Apartamentos</h2>
                    </div>
                    <form id="apartamento-form">
                        <div class="form-group">
                            <label for="nome-proprietario">Nome do Proprietário(a)</label>
                            <input type="text" id="nome-proprietario" placeholder="Nome completo">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cpf-proprietario">CPF</label>
                                <input type="text" id="cpf-proprietario" placeholder="000.000.000-00">
                            </div>
                            <div class="form-group">
                                <label for="numero-relatorios">Nº do Apto (Relatórios)</label>
                                <input type="text" id="numero-relatorios" placeholder="Número oficial">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="numero-porta">Nº do Apto (Porta)</label>
                            <input type="text" id="numero-porta" placeholder="Número que aparece na porta" required>
                        </div>
                        <div class="form-group" style="display: flex; align-items: flex-end;">
                            <button type="submit" class="btn">
                                <i class="fas fa-plus"></i>
                                Adicionar
                            </button>
                        </div>
                    </form>
                    <div class="table-container">
                        <table id="apartamentos-table">
                            <thead>
                                <tr>
                                    <th>Proprietário</th>
                                    <th>CPF</th>
                                    <th>Nº Relatórios</th>
                                    <th>Nº Porta</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="apartamentos-tbody">
                                <!-- Apartamentos serão inseridos aqui via JavaScript -->
                            </tbody>
                        </table>
                        <div id="apartamentos-empty" class="empty-state">
                            <i class="fas fa-building"></i>
                            <p>Nenhum apartamento cadastrado</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Gerenciamento de Dados</h2>
                    </div>
                    <div class="actions">
                        <button class="btn" id="export-data">
                            <i class="fas fa-file-export"></i>
                            Exportar Dados
                        </button>
                        <div class="file-upload">
                            <button class="btn btn-success">
                                <i class="fas fa-file-import"></i>
                                Importar Dados
                            </button>
                            <input type="file" id="import-data" accept=".json">
                        </div>
                        <button class="btn btn-danger" id="clear-data">
                            <i class="fas fa-trash-alt"></i>
                            Limpar Todos os Dados
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Lançamento -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Lançamento</h3>
                <button class="close-modal" onclick="document.getElementById('edit-modal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-lancamento-form">
                    <input type="hidden" id="edit-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-data">Data</label>
                            <input type="text" id="edit-data" readonly>
                        </div>
                        <div class="form-group">
                            <label for="edit-hora">Hora</label>
                            <input type="text" id="edit-hora" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-apartamento">Apartamento</label>
                        <select id="edit-apartamento" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Nomes dos Hóspedes</label>
                        <div class="hospedes-row">
                            <div class="hospede-field">
                                <input type="text" class="edit-hospede-nome" placeholder="Hóspede 1">
                            </div>
                            <div class="hospede-field">
                                <input type="text" class="edit-hospede-nome" placeholder="Hóspede 2">
                            </div>
                            <div class="hospede-field">
                                <input type="text" class="edit-hospede-nome" placeholder="Hóspede 3">
                            </div>
                            <div class="hospede-field">
                                <input type="text" class="edit-hospede-nome" placeholder="Hóspede 4">
                            </div>
                            <div class="hospede-field">
                                <input type="text" class="edit-hospede-nome" placeholder="Hóspede 5">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-quantidade">Quantidade de Pulseiras</label>
                            <input type="number" id="edit-quantidade" min="1" readonly>
                        </div>
                        <div class="form-group">
                            <label for="edit-observacoes">Observações</label>
                            <textarea id="edit-observacoes" rows="2"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="saveLancamentoEdit()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
                <button class="btn btn-danger" onclick="document.getElementById('edit-modal').style.display='none'">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição de Apartamento -->
    <div class="modal" id="edit-apartamento-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Editar Apartamento</h3>
                <button class="close-modal" onclick="document.getElementById('edit-apartamento-modal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-apartamento-form">
                    <input type="hidden" id="edit-apartamento-id">
                    <div class="form-group">
                        <label for="edit-nome-proprietario">Nome do Proprietário(a)</label>
                        <input type="text" id="edit-nome-proprietario" placeholder="Nome completo">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-cpf-proprietario">CPF</label>
                            <input type="text" id="edit-cpf-proprietario" placeholder="000.000.000-00">
                        </div>
                        <div class="form-group">
                            <label for="edit-numero-relatorios">Nº do Apto (Relatórios)</label>
                            <input type="text" id="edit-numero-relatorios" placeholder="Número oficial">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-numero-porta">Nº do Apto (Porta)</label>
                        <input type="text" id="edit-numero-porta" placeholder="Número que aparece na porta" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="saveApartamentoEdit()">
                    <i class="fas fa-save"></i>
                    Salvar
                </button>
                <button class="btn btn-danger" onclick="document.getElementById('edit-apartamento-modal').style.display='none'">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Logout -->
    <div class="modal" id="logout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirmação de Logout</h3>
                <button class="close-modal" onclick="document.getElementById('logout-modal').style.display='none'">&times;</button>
            </div>
            <div class="modal-body">
                <p>Se você sair, será necessário informar usuário e senha novamente para acessar o sistema.</p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="confirm-logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Sair
                </button>
                <button class="btn btn-danger" onclick="document.getElementById('logout-modal').style.display='none'">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operação realizada com sucesso!</span>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Confirmar Ação</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <p>Tem certeza que deseja realizar esta ação?</p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="modal-confirm">Confirmar</button>
                <button class="btn btn-danger" id="modal-cancel">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Credenciais dos usuários
        const USERS = {
            admin: {
                username: 'admin',
                password: '975368',
                role: 'Administrador'
            },
            porteiro: {
                username: 'porteiro',
                password: '172839',
                role: 'Porteiro'
            }
        };

        // Variáveis globais
        let lancamentos = JSON.parse(localStorage.getItem('lancamentos')) || [];
        let compras = JSON.parse(localStorage.getItem('compras')) || [];
        let apartamentos = JSON.parse(localStorage.getItem('apartamentos')) || [];
        let condominio = JSON.parse(localStorage.getItem('condominio')) || {
            nome: '',
            endereco: '',
            cnpj: ''
        };
        let faturasGeradas = JSON.parse(localStorage.getItem('faturasGeradas')) || [];
        let currentUser = null;
        
        // Elementos DOM
        const loginContainer = document.getElementById('login-container');
        const mainContainer = document.getElementById('main-container');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const userType = document.getElementById('user-type');
        const logoutBtn = document.getElementById('logout-btn');
        const logoutModal = document.getElementById('logout-modal');
        const confirmLogoutBtn = document.getElementById('confirm-logout');

        // Verificar se há um usuário logado ao carregar a página
        window.onload = function() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainInterface();
            }
        };

        // Função para lidar com o login
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Verificar credenciais
            if (USERS[username] && USERS[username].password === password) {
                currentUser = {
                    username: USERS[username].username,
                    role: USERS[username].role
                };
                
                // Salvar usuário na sessão
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Mostrar interface principal
                showMainInterface();
                
                // Limpar formulário
                loginForm.reset();
            } else {
                // Mostrar erro
                loginError.style.display = 'block';
                setTimeout(() => {
                    loginError.style.display = 'none';
                }, 3000);
            }
            
            return false;
        }

        // Função para mostrar a interface principal
        function showMainInterface() {
            loginContainer.style.display = 'none';
            mainContainer.style.display = 'block';
            userType.textContent = currentUser.role;
            
            // Configurar permissões baseadas no tipo de usuário
            if (currentUser.role === 'Porteiro') {
                // Esconder abas de administrador para porteiro
                document.querySelectorAll('.admin-tab').forEach(tab => {
                    tab.style.display = 'none';
                });
                document.querySelectorAll('.admin-content').forEach(content => {
                    content.style.display = 'none';
                });
            }
            
            // Carregar dados
            loadApartamentos();
            loadLancamentos();
            loadCompras();
            loadCondominio();
            updateDateTime();
            
            // Configurar eventos
            setupEventListeners();
            
            // Configurar tema
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                document.querySelector('#theme-toggle i').className = 'fas fa-sun';
                document.querySelector('#theme-toggle span').textContent = 'Light Mode';
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Event listener para logout
            logoutBtn.addEventListener('click', function() {
                logoutModal.style.display = 'flex';
            });
            
            // Event listener para confirmação de logout
            confirmLogoutBtn.addEventListener('click', function() {
                sessionStorage.removeItem('currentUser');
                currentUser = null;
                mainContainer.style.display = 'none';
                loginContainer.style.display = 'flex';
                logoutModal.style.display = 'none';
            });
            
            // Event listener para abas
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Ativar aba
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar conteúdo da aba
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Event listener para formulário de lançamento
            document.getElementById('lancamento-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveLancamento();
            });
            
            // Event listener para formulário de compra
            document.getElementById('compra-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCompra();
            });
            
            // Event listener para formulário de condomínio
            document.getElementById('condominio-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCondominio();
            });
            
            // Event listener para formulário de apartamento
            document.getElementById('apartamento-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveApartamento();
            });
            
            // Event listener para toggle de tema
            document.getElementById('theme-toggle').addEventListener('click', function() {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                if (newTheme === 'dark') {
                    this.querySelector('i').className = 'fas fa-sun';
                    this.querySelector('span').textContent = 'Light Mode';
                } else {
                    this.querySelector('i').className = 'fas fa-moon';
                    this.querySelector('span').textContent = 'Dark Mode';
                }
            });
            
            // Event listener para campos de hóspedes
            document.querySelectorAll('.hospede-nome').forEach(input => {
                input.addEventListener('input', updateQuantidadePulseiras);
            });
            
            // Event listener para campo de quantidade comprada
            document.getElementById('qtd-comprada').addEventListener('input', function() {
                const qtd = parseInt(this.value) || 0;
                const custoTotal = parseFloat(document.getElementById('custo-total').value.replace(/\./g, '').replace(',', '.')) || 0;
                
                if (qtd > 0 && custoTotal > 0) {
                    const custoUnitario = custoTotal / qtd;
                    document.getElementById('custo-unitario').value = formatarMoeda(custoUnitario);
                } else {
                    document.getElementById('custo-unitario').value = '';
                }
            });
            
            // Event listener para campo de custo total
            document.getElementById('custo-total').addEventListener('input', function() {
                const qtd = parseInt(document.getElementById('qtd-comprada').value) || 0;
                const custoTotal = parseFloat(this.value.replace(/\./g, '').replace(',', '.')) || 0;
                
                if (qtd > 0 && custoTotal > 0) {
                    const custoUnitario = custoTotal / qtd;
                    document.getElementById('custo-unitario').value = formatarMoeda(custoUnitario);
                } else {
                    document.getElementById('custo-unitario').value = '';
                }
            });
            
            // Event listener para filtros
            document.getElementById('filter-lancamentos').addEventListener('input', filterLancamentos);
            document.getElementById('filter-apartamento').addEventListener('change', filterLancamentos);
            
            // Event listener para período no resumo
            document.getElementById('periodo').addEventListener('change', function() {
                if (this.value) {
                    loadResumo(this.value);
                }
            });
            
            // Event listener para gerar relatório do mês
            document.getElementById('gerar-relatorio-mes').addEventListener('click', function() {
                const periodo = document.getElementById('periodo').value;
                if (periodo) {
                    gerarRelatorioMensal(periodo);
                } else {
                    showToast('Selecione um período para gerar o relatório', 'warning');
                }
            });
            
            // Event listener para gerar relatório de estoque
            document.getElementById('gerar-relatorio-estoque').addEventListener('click', gerarRelatorioEstoque);
            
            // Event listener para gerar faturas
            document.getElementById('gerar-faturas').addEventListener('click', function() {
                const periodo = document.getElementById('relatorio-periodo').value;
                if (periodo) {
                    gerarFaturas(periodo);
                } else {
                    showToast('Selecione um período para gerar as faturas', 'warning');
                }
            });
            
            // Event listener para exportar dados
            document.getElementById('export-data').addEventListener('click', exportarDados);
            
            // Event listener para importar dados
            document.getElementById('import-data').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const data = JSON.parse(event.target.result);
                            importarDados(data);
                        } catch (error) {
                            showToast('Erro ao importar dados. Verifique o formato do arquivo.', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            });
            
            // Event listener para limpar dados
            document.getElementById('clear-data').addEventListener('click', function() {
                showModal(
                    'Limpar Todos os Dados',
                    'Tem certeza que deseja limpar todos os dados? Esta ação não pode ser desfeita.',
                    function() {
                        localStorage.clear();
                        location.reload();
                    }
                );
            });
            
            // Máscaras de campos
            // CPF
            document.getElementById('cpf-proprietario').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 11) {
                    value = value.substring(0, 11);
                }
                
                if (value.length > 9) {
                    value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6, 9) + '-' + value.substring(9);
                } else if (value.length > 6) {
                    value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6);
                } else if (value.length > 3) {
                    value = value.substring(0, 3) + '.' + value.substring(3);
                }
                
                e.target.value = value;
            });
            
            // CNPJ
            document.getElementById('cnpj-condominio').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 14) {
                    value = value.substring(0, 14);
                }
                
                if (value.length > 12) {
                    value = value.substring(0, 2) + '.' + value.substring(2, 5) + '.' + value.substring(5, 8) + '/' + value.substring(8, 12) + '-' + value.substring(12);
                } else if (value.length > 8) {
                    value = value.substring(0, 2) + '.' + value.substring(2, 5) + '.' + value.substring(5, 8) + '/' + value.substring(8);
                } else if (value.length > 5) {
                    value = value.substring(0, 2) + '.' + value.substring(2, 5) + '.' + value.substring(5);
                } else if (value.length > 2) {
                    value = value.substring(0, 2) + '.' + value.substring(2);
                }
                
                e.target.value = value;
            });
            
            // Formatação monetária para campos de valor
            document.getElementById('custo-total').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d)(\d{2})$/, '$1,$2');
                value = value.replace(/(?=(\d{3})+(\D))\B/g, '.');
                e.target.value = value;
            });
            
            // Máscaras para campos de edição
            document.getElementById('edit-cpf-proprietario').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 11) {
                    value = value.substring(0, 11);
                }
                
                if (value.length > 9) {
                    value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6, 9) + '-' + value.substring(9);
                } else if (value.length > 6) {
                    value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6);
                } else if (value.length > 3) {
                    value = value.substring(0, 3) + '.' + value.substring(3);
                }
                
                e.target.value = value;
            });
        }

        // Função para atualizar data e hora
        function updateDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString('pt-BR');
            const time = now.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('data-hora').value = `${date} ${time}`;
            
            // Atualizar a cada minuto
            setTimeout(updateDateTime, 60000);
        }

        // Função para atualizar quantidade de pulseiras baseado nos hóspedes
        function updateQuantidadePulseiras() {
            const hospedes = document.querySelectorAll('.hospede-nome');
            let count = 0;
            
            hospedes.forEach(input => {
                if (input.value.trim() !== '') {
                    count++;
                }
            });
            
            document.getElementById('quantidade').value = count;
        }

        // Função para salvar lançamento
        function saveLancamento() {
            const apartamento = document.getElementById('apartamento').value;
            const dataHora = document.getElementById('data-hora').value;
            const [data, hora] = dataHora.split(' ');
            
            // Obter hóspedes
            const hospedes = [];
            document.querySelectorAll('.hospede-nome').forEach(input => {
                if (input.value.trim() !== '') {
                    hospedes.push(input.value.trim());
                }
            });
            
            const quantidade = parseInt(document.getElementById('quantidade').value) || 0;
            const observacoes = document.getElementById('observacoes').value;
            
            if (!apartamento || quantidade === 0) {
                showToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            // Criar objeto de lançamento
            const lancamento = {
                id: Date.now(),
                apartamento,
                data,
                hora,
                hospedes,
                quantidade,
                observacoes
            };
            
            // Adicionar ao array
            lancamentos.push(lancamento);
            
            // Salvar no localStorage
            localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
            
            // Recarregar tabela
            loadLancamentos();
            
            // Limpar formulário
            document.getElementById('lancamento-form').reset();
            updateDateTime();
            
            // Mostrar notificação
            showToast('Lançamento salvo com sucesso!', 'success');
        }

        // Função para carregar lançamentos
        function loadLancamentos() {
            const tbody = document.getElementById('lancamentos-tbody');
            const emptyState = document.getElementById('lancamentos-empty');
            const filterApartamento = document.getElementById('filter-apartamento');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Preencher filtro de apartamentos
            filterApartamento.innerHTML = '<option value="">Todos Apartamentos</option>';
            apartamentos.forEach(apartamento => {
                const option = document.createElement('option');
                option.value = apartamento.id;
                option.textContent = apartamento.numeroPorta;
                filterApartamento.appendChild(option);
            });
            
            // Preencher select de apartamentos no formulário
            const apartamentoSelect = document.getElementById('apartamento');
            apartamentoSelect.innerHTML = '<option value="">Selecione...</option>';
            apartamentos.forEach(apartamento => {
                const option = document.createElement('option');
                option.value = apartamento.id;
                option.textContent = apartamento.numeroPorta;
                apartamentoSelect.appendChild(option);
            });
            
            // Preencher select de apartamentos no modal de edição
            const editApartamentoSelect = document.getElementById('edit-apartamento');
            editApartamentoSelect.innerHTML = '<option value="">Selecione...</option>';
            apartamentos.forEach(apartamento => {
                const option = document.createElement('option');
                option.value = apartamento.id;
                option.textContent = apartamento.numeroPorta;
                editApartamentoSelect.appendChild(option);
            });
            
            // Verificar se há lançamentos
            if (lancamentos.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar lançamentos por data e hora (mais recentes primeiro)
            const sortedLancamentos = [...lancamentos].sort((a, b) => {
                const dateA = new Date(`${a.data} ${a.hora}`);
                const dateB = new Date(`${b.data} ${b.hora}`);
                return dateB - dateA;
            });
            
            // Adicionar lançamentos à tabela
            sortedLancamentos.forEach(lancamento => {
                const tr = document.createElement('tr');
                
                // Encontrar apartamento
                const apto = apartamentos.find(a => a.id === lancamento.apartamento);
                const aptoNumero = apto ? apto.numeroPorta : 'Desconhecido';
                
                // Criar lista de hóspedes
                const hospedesList = document.createElement('div');
                hospedesList.className = 'hospedes-list';
                lancamento.hospedes.forEach(hospede => {
                    const item = document.createElement('div');
                    item.className = 'hospede-item';
                    item.innerHTML = `<i class="fas fa-user"></i> ${hospede}`;
                    hospedesList.appendChild(item);
                });
                
                tr.innerHTML = `
                    <td>${aptoNumero}</td>
                    <td>${lancamento.data}</td>
                    <td>${lancamento.hora}</td>
                    <td>${hospedesList.outerHTML}</td>
                    <td>${lancamento.quantidade}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-info" onclick="editLancamento(${lancamento.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteLancamento(${lancamento.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para filtrar lançamentos
        function filterLancamentos() {
            const filterText = document.getElementById('filter-lancamentos').value.toLowerCase();
            const filterApto = document.getElementById('filter-apartamento').value;
            const rows = document.querySelectorAll('#lancamentos-tbody tr');
            
            rows.forEach(row => {
                const aptoCell = row.cells[0].textContent.toLowerCase();
                const hospedesCell = row.cells[3].textContent.toLowerCase();
                const aptoId = row.querySelector('button').getAttribute('onclick').match(/editLancamento\((\d+)\)/)[1];
                const lancamento = lancamentos.find(l => l.id == aptoId);
                
                const matchesText = aptoCell.includes(filterText) || hospedesCell.includes(filterText);
                const matchesApto = !filterApto || lancamento.apartamento == filterApto;
                
                if (matchesText && matchesApto) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Função para editar lançamento
        function editLancamento(id) {
            const lancamento = lancamentos.find(l => l.id === id);
            if (!lancamento) return;
            
            // Preencher formulário de edição
            document.getElementById('edit-id').value = lancamento.id;
            document.getElementById('edit-data').value = lancamento.data;
            document.getElementById('edit-hora').value = lancamento.hora;
            document.getElementById('edit-apartamento').value = lancamento.apartamento;
            document.getElementById('edit-quantidade').value = lancamento.quantidade;
            document.getElementById('edit-observacoes').value = lancamento.observacoes;
            
            // Preencher hóspedes
            const hospedeInputs = document.querySelectorAll('.edit-hospede-nome');
            hospedeInputs.forEach((input, index) => {
                input.value = lancamento.hospedes[index] || '';
            });
            
            // Mostrar modal
            document.getElementById('edit-modal').style.display = 'flex';
        }

        // Função para salvar edição de lançamento
        function saveLancamentoEdit() {
            const id = parseInt(document.getElementById('edit-id').value);
            const apartamento = document.getElementById('edit-apartamento').value;
            const data = document.getElementById('edit-data').value;
            const hora = document.getElementById('edit-hora').value;
            const quantidade = parseInt(document.getElementById('edit-quantidade').value) || 0;
            const observacoes = document.getElementById('edit-observacoes').value;
            
            // Obter hóspedes
            const hospedes = [];
            document.querySelectorAll('.edit-hospede-nome').forEach(input => {
                if (input.value.trim() !== '') {
                    hospedes.push(input.value.trim());
                }
            });
            
            if (!apartamento || quantidade === 0) {
                showToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            // Encontrar índice do lançamento
            const index = lancamentos.findIndex(l => l.id === id);
            if (index === -1) return;
            
            // Atualizar lançamento
            lancamentos[index] = {
                id,
                apartamento,
                data,
                hora,
                hospedes,
                quantidade,
                observacoes
            };
            
            // Salvar no localStorage
            localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
            
            // Recarregar tabela
            loadLancamentos();
            
            // Fechar modal
            document.getElementById('edit-modal').style.display = 'none';
            
            // Mostrar notificação
            showToast('Lançamento atualizado com sucesso!', 'success');
        }

        // Função para excluir lançamento
        function deleteLancamento(id) {
            showModal(
                'Excluir Lançamento',
                'Tem certeza que deseja excluir este lançamento?',
                function() {
                    // Encontrar índice do lançamento
                    const index = lancamentos.findIndex(l => l.id === id);
                    if (index === -1) return;
                    
                    // Remover lançamento
                    lancamentos.splice(index, 1);
                    
                    // Salvar no localStorage
                    localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
                    
                    // Recarregar tabela
                    loadLancamentos();
                    
                    // Mostrar notificação
                    showToast('Lançamento excluído com sucesso!', 'success');
                }
            );
        }

        // Função para carregar resumo
        function loadResumo(periodo) {
            const [year, month] = periodo.split('-');
            const emptyState = document.getElementById('resumo-empty');
            const tbody = document.getElementById('resumo-tbody');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Filtrar lançamentos do período
            const lancamentosPeriodo = lancamentos.filter(l => {
                const [lancamentoDay, lancamentoMonth, lancamentoYear] = l.data.split('/');
                return lancamentoMonth === month && lancamentoYear === year;
            });
            
            // Verificar se há lançamentos
            if (lancamentosPeriodo.length === 0) {
                emptyState.style.display = 'block';
                
                // Zerar resumo
                document.getElementById('total-pulseiras').textContent = '0';
                document.getElementById('total-apartamentos').textContent = '0';
                document.getElementById('valor-total').textContent = 'R$ 0,00';
                document.getElementById('custo-medio').textContent = 'R$ 0,00';
                
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Agrupar lançamentos por apartamento
            const apartamentosConsumo = {};
            let totalPulseiras = 0;
            
            lancamentosPeriodo.forEach(lancamento => {
                if (!apartamentosConsumo[lancamento.apartamento]) {
                    apartamentosConsumo[lancamento.apartamento] = 0;
                }
                apartamentosConsumo[lancamento.apartamento] += lancamento.quantidade;
                totalPulseiras += lancamento.quantidade;
            });
            
            // Calcular custo médio
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            // Atualizar resumo
            document.getElementById('total-pulseiras').textContent = totalPulseiras;
            document.getElementById('total-apartamentos').textContent = Object.keys(apartamentosConsumo).length;
            document.getElementById('valor-total').textContent = formatarMoeda(totalPulseiras * custoMedio);
            document.getElementById('custo-medio').textContent = formatarMoeda(custoMedio);
            
            // Adicionar apartamentos à tabela
            Object.keys(apartamentosConsumo).forEach(apartamentoId => {
                const apto = apartamentos.find(a => a.id === apartamentoId);
                if (!apto) return;
                
                const quantidade = apartamentosConsumo[apartamentoId];
                const valorTotal = quantidade * custoMedio;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${apto.numeroPorta}</td>
                    <td>${quantidade}</td>
                    <td>${formatarMoeda(custoMedio)}</td>
                    <td>${formatarMoeda(valorTotal)}</td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para salvar compra
        function saveCompra() {
            const data = document.getElementById('data-compra').value;
            const quantidade = parseInt(document.getElementById('qtd-comprada').value) || 0;
            const custoTotal = parseFloat(document.getElementById('custo-total').value.replace(/\./g, '').replace(',', '.')) || 0;
            const custoUnitario = parseFloat(document.getElementById('custo-unitario').value.replace(/\./g, '').replace(',', '.')) || 0;
            
            if (!data || quantidade === 0 || custoTotal === 0) {
                showToast('Preencha todos os campos obrigatórios', 'error');
                return;
            }
            
            // Criar objeto de compra
            const compra = {
                id: Date.now(),
                data,
                quantidade,
                custoTotal,
                custoUnitario
            };
            
            // Adicionar ao array
            compras.push(compra);
            
            // Salvar no localStorage
            localStorage.setItem('compras', JSON.stringify(compras));
            
            // Recarregar tabela
            loadCompras();
            
            // Limpar formulário
            document.getElementById('compra-form').reset();
            
            // Mostrar notificação
            showToast('Compra registrada com sucesso!', 'success');
        }

        // Função para carregar compras
        function loadCompras() {
            const tbody = document.getElementById('compras-tbody');
            const emptyState = document.getElementById('compras-empty');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Verificar se há compras
            if (compras.length === 0) {
                emptyState.style.display = 'block';
                
                // Zerar resumo
                document.getElementById('total-comprado').textContent = '0';
                document.getElementById('total-entregue').textContent = '0';
                document.getElementById('saldo-disponivel').textContent = '0';
                document.getElementById('custo-medio-estoque').textContent = 'R$ 0,00';
                
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar compras por data (mais recentes primeiro)
            const sortedCompras = [...compras].sort((a, b) => {
                return new Date(b.data) - new Date(a.data);
            });
            
            // Adicionar compras à tabela
            sortedCompras.forEach(compra => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${formatDate(compra.data)}</td>
                    <td>${compra.quantidade}</td>
                    <td>${formatarMoeda(compra.custoTotal)}</td>
                    <td>${formatarMoeda(compra.custoUnitario)}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-danger" onclick="deleteCompra(${compra.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
            
            // Atualizar resumo
            updateEstoqueResumo();
        }

        // Função para atualizar resumo de estoque
        function updateEstoqueResumo() {
            const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
            const totalEntregue = lancamentos.reduce((sum, lancamento) => sum + lancamento.quantidade, 0);
            const saldoDisponivel = totalComprado - totalEntregue;
            
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            document.getElementById('total-comprado').textContent = totalComprado;
            document.getElementById('total-entregue').textContent = totalEntregue;
            document.getElementById('saldo-disponivel').textContent = saldoDisponivel;
            document.getElementById('custo-medio-estoque').textContent = formatarMoeda(custoMedio);
        }

        // Função para excluir compra
        function deleteCompra(id) {
            showModal(
                'Excluir Compra',
                'Tem certeza que deseja excluir esta compra?',
                function() {
                    // Encontrar índice da compra
                    const index = compras.findIndex(c => c.id === id);
                    if (index === -1) return;
                    
                    // Remover compra
                    compras.splice(index, 1);
                    
                    // Salvar no localStorage
                    localStorage.setItem('compras', JSON.stringify(compras));
                    
                    // Recarregar tabela
                    loadCompras();
                    
                    // Mostrar notificação
                    showToast('Compra excluída com sucesso!', 'success');
                }
            );
        }

        // Função para salvar condomínio
        function saveCondominio() {
            condominio.nome = document.getElementById('nome-condominio').value;
            condominio.endereco = document.getElementById('endereco-condominio').value;
            condominio.cnpj = document.getElementById('cnpj-condominio').value;
            
            // Salvar no localStorage
            localStorage.setItem('condominio', JSON.stringify(condominio));
            
            // Mostrar notificação
            showToast('Dados do condomínio salvos com sucesso!', 'success');
        }

        // Função para carregar condomínio
        function loadCondominio() {
            document.getElementById('nome-condominio').value = condominio.nome;
            document.getElementById('endereco-condominio').value = condominio.endereco;
            document.getElementById('cnpj-condominio').value = condominio.cnpj;
        }

        // Função para salvar apartamento
        function saveApartamento() {
            const nomeProprietario = document.getElementById('nome-proprietario').value;
            const cpfProprietario = document.getElementById('cpf-proprietario').value;
            const numeroRelatorios = document.getElementById('numero-relatorios').value;
            const numeroPorta = document.getElementById('numero-porta').value;
            
            if (!numeroPorta) {
                showToast('O número do apartamento (porta) é obrigatório', 'error');
                return;
            }
            
            // Criar objeto de apartamento
            const apartamento = {
                id: Date.now(),
                nomeProprietario,
                cpfProprietario,
                numeroRelatorios,
                numeroPorta
            };
            
            // Adicionar ao array
            apartamentos.push(apartamento);
            
            // Salvar no localStorage
            localStorage.setItem('apartamentos', JSON.stringify(apartamentos));
            
            // Recarregar tabela
            loadApartamentos();
            
            // Limpar formulário
            document.getElementById('apartamento-form').reset();
            
            // Mostrar notificação
            showToast('Apartamento cadastrado com sucesso!', 'success');
        }

        // Função para carregar apartamentos
        function loadApartamentos() {
            const tbody = document.getElementById('apartamentos-tbody');
            const emptyState = document.getElementById('apartamentos-empty');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Verificar se há apartamentos
            if (apartamentos.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar apartamentos por número
            const sortedApartamentos = [...apartamentos].sort((a, b) => {
                return a.numeroPorta.localeCompare(b.numeroPorta, undefined, { numeric: true });
            });
            
            // Adicionar apartamentos à tabela
            sortedApartamentos.forEach(apartamento => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${apartamento.nomeProprietario || '-'}</td>
                    <td>${apartamento.cpfProprietario || '-'}</td>
                    <td>${apartamento.numeroRelatorios || '-'}</td>
                    <td>${apartamento.numeroPorta}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-info" onclick="editApartamento(${apartamento.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteApartamento(${apartamento.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para editar apartamento
        function editApartamento(id) {
            const apartamento = apartamentos.find(a => a.id === id);
            if (!apartamento) return;
            
            // Preencher formulário de edição
            document.getElementById('edit-apartamento-id').value = apartamento.id;
            document.getElementById('edit-nome-proprietario').value = apartamento.nomeProprietario || '';
            document.getElementById('edit-cpf-proprietario').value = apartamento.cpfProprietario || '';
            document.getElementById('edit-numero-relatorios').value = apartamento.numeroRelatorios || '';
            document.getElementById('edit-numero-porta').value = apartamento.numeroPorta;
            
            // Mostrar modal
            document.getElementById('edit-apartamento-modal').style.display = 'flex';
        }

        // Função para salvar edição de apartamento
        function saveApartamentoEdit() {
            const id = parseInt(document.getElementById('edit-apartamento-id').value);
            const nomeProprietario = document.getElementById('edit-nome-proprietario').value;
            const cpfProprietario = document.getElementById('edit-cpf-proprietario').value;
            const numeroRelatorios = document.getElementById('edit-numero-relatorios').value;
            const numeroPorta = document.getElementById('edit-numero-porta').value;
            
            if (!numeroPorta) {
                showToast('O número do apartamento (porta) é obrigatório', 'error');
                return;
            }
            
            // Encontrar índice do apartamento
            const index = apartamentos.findIndex(a => a.id === id);
            if (index === -1) return;
            
            // Atualizar apartamento
            apartamentos[index] = {
                id,
                nomeProprietario,
                cpfProprietario,
                numeroRelatorios,
                numeroPorta
            };
            
            // Salvar no localStorage
            localStorage.setItem('apartamentos', JSON.stringify(apartamentos));
            
            // Recarregar tabela
            loadApartamentos();
            
            // Fechar modal
            document.getElementById('edit-apartamento-modal').style.display = 'none';
            
            // Mostrar notificação
            showToast('Apartamento atualizado com sucesso!', 'success');
        }

        // Função para excluir apartamento
        function deleteApartamento(id) {
            showModal(
                'Excluir Apartamento',
                'Tem certeza que deseja excluir este apartamento?',
                function() {
                    // Verificar se há lançamentos para este apartamento
                    const hasLancamentos = lancamentos.some(l => l.apartamento == id);
                    
                    if (hasLancamentos) {
                        showToast('Não é possível excluir este apartamento pois existem lançamentos vinculados a ele', 'error');
                        return;
                    }
                    
                    // Encontrar índice do apartamento
                    const index = apartamentos.findIndex(a => a.id === id);
                    if (index === -1) return;
                    
                    // Remover apartamento
                    apartamentos.splice(index, 1);
                    
                    // Salvar no localStorage
                    localStorage.setItem('apartamentos', JSON.stringify(apartamentos));
                    
                    // Recarregar tabela
                    loadApartamentos();
                    
                    // Mostrar notificação
                    showToast('Apartamento excluído com sucesso!', 'success');
                }
            );
        }

        // Função para exportar dados
        function exportarDados() {
            const dados = {
                condominio,
                apartamentos,
                lancamentos,
                compras,
                faturasGeradas,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            saveAs(blob, `controle-pulseiras-${formatDateForFile(new Date())}.json`);
            
            showToast('Dados exportados com sucesso!', 'success');
        }

        // Função para importar dados
        function importarDados(dados) {
            // Validar dados
            if (!dados.condominio || !dados.apartamentos || !dados.lancamentos || !dados.compras) {
                showToast('Formato de arquivo inválido', 'error');
                return;
            }
            
            // Confirmar importação
            showModal(
                'Importar Dados',
                'Todos os dados atuais serão substituídos. Deseja continuar?',
                function() {
                    // Importar dados
                    condominio = dados.condominio;
                    apartamentos = dados.apartamentos;
                    lancamentos = dados.lancamentos;
                    compras = dados.compras;
                    faturasGeradas = dados.faturasGeradas || [];
                    
                    // Salvar no localStorage
                    localStorage.setItem('condominio', JSON.stringify(condominio));
                    localStorage.setItem('apartamentos', JSON.stringify(apartamentos));
                    localStorage.setItem('lancamentos', JSON.stringify(lancamentos));
                    localStorage.setItem('compras', JSON.stringify(compras));
                    localStorage.setItem('faturasGeradas', JSON.stringify(faturasGeradas));
                    
                    // Recarregar dados
                    loadApartamentos();
                    loadLancamentos();
                    loadCompras();
                    loadCondominio();
                    
                    // Mostrar notificação
                    showToast('Dados importados com sucesso!', 'success');
                }
            );
        }

        // Função para gerar relatório mensal
        function gerarRelatorioMensal(periodo) {
            const [year, month] = periodo.split('-');
            
            // Filtrar lançamentos do período
            const lancamentosPeriodo = lancamentos.filter(l => {
                const [lancamentoDay, lancamentoMonth, lancamentoYear] = l.data.split('/');
                return lancamentoMonth === month && lancamentoYear === year;
            });
            
            // Agrupar lançamentos por apartamento
            const apartamentosConsumo = {};
            let totalPulseiras = 0;
            
            lancamentosPeriodo.forEach(lancamento => {
                if (!apartamentosConsumo[lancamento.apartamento]) {
                    apartamentosConsumo[lancamento.apartamento] = 0;
                }
                apartamentosConsumo[lancamento.apartamento] += lancamento.quantidade;
                totalPulseiras += lancamento.quantidade;
            });
            
            // Calcular custo médio
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            // Criar PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adicionar título
            doc.setFontSize(18);
            doc.text('Relatório Mensal de Consumo de Pulseiras', 105, 15, { align: 'center' });
            
            // Adicionar período
            doc.setFontSize(12);
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            doc.text(`Período: ${monthNames[parseInt(month) - 1]} de ${year}`, 105, 25, { align: 'center' });
            
            // Adicionar dados do condomínio
            doc.setFontSize(10);
            doc.text(`Condomínio: ${condominio.nome}`, 20, 35);
            doc.text(`Endereço: ${condominio.endereco}`, 20, 40);
            doc.text(`CNPJ: ${condominio.cnpj}`, 20, 45);
            
            // Adicionar resumo
            doc.setFontSize(12);
            doc.text('Resumo', 20, 55);
            doc.setFontSize(10);
            doc.text(`Total de Pulseiras: ${totalPulseiras}`, 20, 65);
            doc.text(`Apartamentos com Consumo: ${Object.keys(apartamentosConsumo).length}`, 20, 70);
            doc.text(`Valor Total: ${formatarMoeda(totalPulseiras * custoMedio)}`, 20, 75);
            doc.text(`Custo Médio por Pulseira: ${formatarMoeda(custoMedio)}`, 20, 80);
            
            // Adicionar tabela de consumo por apartamento
            const tableData = [];
            Object.keys(apartamentosConsumo).forEach(apartamentoId => {
                const apto = apartamentos.find(a => a.id === apartamentoId);
                if (!apto) return;
                
                const quantidade = apartamentosConsumo[apartamentoId];
                const valorTotal = quantidade * custoMedio;
                
                tableData.push([
                    apto.numeroPorta,
                    quantidade,
                    formatarMoeda(custoMedio),
                    formatarMoeda(valorTotal)
                ]);
            });
            
            doc.autoTable({
                head: [['Apartamento', 'Pulseiras', 'Valor Unitário', 'Valor a Pagar']],
                body: tableData,
                startY: 90,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [67, 97, 238] }
            });
            
            // Salvar PDF
            doc.save(`relatorio-mensal-${periodo}.pdf`);
            
            // Mostrar notificação
            showToast('Relatório gerado com sucesso!', 'success');
        }

        // Função para gerar relatório de estoque
        function gerarRelatorioEstoque() {
            // Calcular totais
            const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
            const totalEntregue = lancamentos.reduce((sum, lancamento) => sum + lancamento.quantidade, 0);
            const saldoDisponivel = totalComprado - totalEntregue;
            
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            // Criar PDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adicionar título
            doc.setFontSize(18);
            doc.text('Relatório Geral de Estoque', 105, 15, { align: 'center' });
            
            // Adicionar data
            doc.setFontSize(12);
            doc.text(`Data: ${formatDate(new Date().toISOString().split('T')[0])}`, 105, 25, { align: 'center' });
            
            // Adicionar dados do condomínio
            doc.setFontSize(10);
            doc.text(`Condomínio: ${condominio.nome}`, 20, 35);
            doc.text(`Endereço: ${condominio.endereco}`, 20, 40);
            doc.text(`CNPJ: ${condominio.cnpj}`, 20, 45);
            
            // Adicionar resumo
            doc.setFontSize(12);
            doc.text('Resumo de Estoque', 20, 55);
            doc.setFontSize(10);
            doc.text(`Total Comprado: ${totalComprado}`, 20, 65);
            doc.text(`Total Entregue: ${totalEntregue}`, 20, 70);
            doc.text(`Saldo Disponível: ${saldoDisponivel}`, 20, 75);
            doc.text(`Custo Médio: ${formatarMoeda(custoMedio)}`, 20, 80);
            
            // Adicionar tabela de compras
            const comprasData = [];
            compras.forEach(compra => {
                comprasData.push([
                    formatDate(compra.data),
                    compra.quantidade,
                    formatarMoeda(compra.custoTotal),
                    formatarMoeda(compra.custoUnitario)
                ]);
            });
            
            doc.autoTable({
                head: [['Data', 'Quantidade', 'Custo Total', 'Custo Unitário']],
                body: comprasData,
                startY: 90,
                styles: { fontSize: 10 },
                headStyles: { fillColor: [67, 97, 238] }
            });
            
            // Salvar PDF
            doc.save(`relatorio-estoque-${formatDateForFile(new Date())}.pdf`);
            
            // Mostrar notificação
            showToast('Relatório gerado com sucesso!', 'success');
        }

        // Função para gerar faturas
        function gerarFaturas(periodo) {
            const [year, month] = periodo.split('-');
            
            // Filtrar lançamentos do período
            const lancamentosPeriodo = lancamentos.filter(l => {
                const [lancamentoDay, lancamentoMonth, lancamentoYear] = l.data.split('/');
                return lancamentoMonth === month && lancamentoYear === year;
            });
            
            // Agrupar lançamentos por apartamento
            const apartamentosConsumo = {};
            
            lancamentosPeriodo.forEach(lancamento => {
                if (!apartamentosConsumo[lancamento.apartamento]) {
                    apartamentosConsumo[lancamento.apartamento] = 0;
                }
                apartamentosConsumo[lancamento.apartamento] += lancamento.quantidade;
            });
            
            // Calcular custo médio
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            // Criar ZIP com todas as faturas
            const zip = new JSZip();
            
            // Gerar fatura para cada apartamento
            Object.keys(apartamentosConsumo).forEach(apartamentoId => {
                const apto = apartamentos.find(a => a.id === apartamentoId);
                if (!apto) return;
                
                const quantidade = apartamentosConsumo[apartamentoId];
                const valorTotal = quantidade * custoMedio;
                
                // Criar PDF da fatura
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Adicionar título
                doc.setFontSize(18);
                doc.text('Fatura de Consumo de Pulseiras', 105, 15, { align: 'center' });
                
                // Adicionar período
                doc.setFontSize(12);
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                doc.text(`Período: ${monthNames[parseInt(month) - 1]} de ${year}`, 105, 25, { align: 'center' });
                
                // Adicionar dados do condomínio
                doc.setFontSize(10);
                doc.text(`Condomínio: ${condominio.nome}`, 20, 35);
                doc.text(`Endereço: ${condominio.endereco}`, 20, 40);
                doc.text(`CNPJ: ${condominio.cnpj}`, 20, 45);
                
                // Adicionar dados do apartamento
                doc.text(`Apartamento: ${apto.numeroPorta}`, 20, 55);
                doc.text(`Proprietário: ${apto.nomeProprietario || '-'}`, 20, 60);
                doc.text(`CPF: ${apto.cpfProprietario || '-'}`, 20, 65);
                
                // Adicionar detalhes da fatura
                doc.setFontSize(12);
                doc.text('Detalhes da Fatura', 20, 80);
                doc.setFontSize(10);
                doc.text(`Quantidade de Pulseiras: ${quantidade}`, 20, 90);
                doc.text(`Valor Unitário: ${formatarMoeda(custoMedio)}`, 20, 95);
                doc.text(`Valor Total: ${formatarMoeda(valorTotal)}`, 20, 100);
                
                // Adicionar data de geração
                doc.text(`Data de Geração: ${formatDate(new Date().toISOString().split('T')[0])}`, 20, 110);
                
                // Salvar PDF no ZIP
                const pdfBlob = doc.output('blob');
                zip.file(`fatura-${apto.numeroPorta}-${periodo}.pdf`, pdfBlob);
                
                // Salvar fatura gerada
                faturasGeradas.push({
                    id: Date.now() + Math.random(),
                    apartamento: apartamentoId,
                    periodo,
                    dataGeracao: new Date().toISOString().split('T')[0]
                });
            });
            
            // Salvar faturas geradas
            localStorage.setItem('faturasGeradas', JSON.stringify(faturasGeradas));
            
            // Gerar e baixar ZIP
            zip.generateAsync({ type: 'blob' }).then(function(content) {
                saveAs(content, `faturas-${periodo}.zip`);
                
                // Recarregar tabela de faturas
                loadFaturas();
                
                // Mostrar notificação
                showToast('Faturas geradas com sucesso!', 'success');
            });
        }

        // Função para carregar faturas
        function loadFaturas() {
            const tbody = document.getElementById('faturas-tbody');
            const emptyState = document.getElementById('faturas-empty');
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            // Verificar se há faturas
            if (faturasGeradas.length === 0) {
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Ordenar faturas por data de geração (mais recentes primeiro)
            const sortedFaturas = [...faturasGeradas].sort((a, b) => {
                return new Date(b.dataGeracao) - new Date(a.dataGeracao);
            });
            
            // Adicionar faturas à tabela
            sortedFaturas.forEach(fatura => {
                const apto = apartamentos.find(a => a.id === fatura.apartamento);
                if (!apto) return;
                
                // Calcular quantidade de pulseiras
                const [year, month] = fatura.periodo.split('-');
                const lancamentosPeriodo = lancamentos.filter(l => {
                    const [lancamentoDay, lancamentoMonth, lancamentoYear] = l.data.split('/');
                    return lancamentoMonth === month && lancamentoYear === year && l.apartamento === fatura.apartamento;
                });
                
                const quantidade = lancamentosPeriodo.reduce((sum, l) => sum + l.quantidade, 0);
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${apto.numeroPorta}</td>
                    <td>${apto.nomeProprietario || '-'}</td>
                    <td>${apto.cpfProprietario || '-'}</td>
                    <td>${quantidade}</td>
                    <td>${fatura.periodo}</td>
                    <td>${formatDate(fatura.dataGeracao)}</td>
                    <td>
                        <div class="actions">
                            <button class="btn btn-info" onclick="baixarFatura('${fatura.apartamento}', '${fatura.periodo}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-danger" onclick="deleteFatura('${fatura.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(tr);
            });
        }

        // Função para baixar fatura individual
        function baixarFatura(apartamentoId, periodo) {
            const apto = apartamentos.find(a => a.id === apartamentoId);
            if (!apto) return;
            
            const [year, month] = periodo.split('-');
            
            // Filtrar lançamentos do período
            const lancamentosPeriodo = lancamentos.filter(l => {
                const [lancamentoDay, lancamentoMonth, lancamentoYear] = l.data.split('/');
                return lancamentoMonth === month && lancamentoYear === year && l.apartamento === apartamentoId;
            });
            
            // Calcular quantidade e valor total
            const quantidade = lancamentosPeriodo.reduce((sum, l) => sum + l.quantidade, 0);
            
            // Calcular custo médio
            let custoMedio = 0;
            if (compras.length > 0) {
                const totalComprado = compras.reduce((sum, compra) => sum + compra.quantidade, 0);
                const totalCusto = compras.reduce((sum, compra) => sum + compra.custoTotal, 0);
                custoMedio = totalComprado > 0 ? totalCusto / totalComprado : 0;
            }
            
            const valorTotal = quantidade * custoMedio;
            
            // Criar PDF da fatura
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Adicionar título
            doc.setFontSize(18);
            doc.text('Fatura de Consumo de Pulseiras', 105, 15, { align: 'center' });
            
            // Adicionar período
            doc.setFontSize(12);
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            doc.text(`Período: ${monthNames[parseInt(month) - 1]} de ${year}`, 105, 25, { align: 'center' });
            
            // Adicionar dados do condomínio
            doc.setFontSize(10);
            doc.text(`Condomínio: ${condominio.nome}`, 20, 35);
            doc.text(`Endereço: ${condominio.endereco}`, 20, 40);
            doc.text(`CNPJ: ${condominio.cnpj}`, 20, 45);
            
            // Adicionar dados do apartamento
            doc.text(`Apartamento: ${apto.numeroPorta}`, 20, 55);
            doc.text(`Proprietário: ${apto.nomeProprietario || '-'}`, 20, 60);
            doc.text(`CPF: ${apto.cpfProprietario || '-'}`, 20, 65);
            
            // Adicionar detalhes da fatura
            doc.setFontSize(12);
            doc.text('Detalhes da Fatura', 20, 80);
            doc.setFontSize(10);
            doc.text(`Quantidade de Pulseiras: ${quantidade}`, 20, 90);
            doc.text(`Valor Unitário: ${formatarMoeda(custoMedio)}`, 20, 95);
            doc.text(`Valor Total: ${formatarMoeda(valorTotal)}`, 20, 100);
            
            // Adicionar data de geração
            doc.text(`Data de Geração: ${formatDate(new Date().toISOString().split('T')[0])}`, 20, 110);
            
            // Salvar PDF
            doc.save(`fatura-${apto.numeroPorta}-${periodo}.pdf`);
            
            // Mostrar notificação
            showToast('Fatura baixada com sucesso!', 'success');
        }

        // Função para excluir fatura
        function deleteFatura(id) {
            showModal(
                'Excluir Fatura',
                'Tem certeza que deseja excluir esta fatura?',
                function() {
                    // Encontrar índice da fatura
                    const index = faturasGeradas.findIndex(f => f.id == id);
                    if (index === -1) return;
                    
                    // Remover fatura
                    faturasGeradas.splice(index, 1);
                    
                    // Salvar no localStorage
                    localStorage.setItem('faturasGeradas', JSON.stringify(faturasGeradas));
                    
                    // Recarregar tabela
                    loadFaturas();
                    
                    // Mostrar notificação
                    showToast('Fatura excluída com sucesso!', 'success');
                }
            );
        }

        // Função para mostrar modal
        function showModal(title, message, onConfirm) {
            const modal = document.getElementById('modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const modalConfirm = document.getElementById('modal-confirm');
            const modalCancel = document.getElementById('modal-cancel');
            const closeModal = document.getElementById('close-modal');
            
            // Configurar modal
            modalTitle.textContent = title;
            modalBody.innerHTML = `<p>${message}</p>`;
            
            // Configurar eventos
            modalConfirm.onclick = function() {
                onConfirm();
                modal.style.display = 'none';
            };
            
            modalCancel.onclick = function() {
                modal.style.display = 'none';
            };
            
            closeModal.onclick = function() {
                modal.style.display = 'none';
            };
            
            // Mostrar modal
            modal.style.display = 'flex';
        }

        // Função para mostrar notificação toast
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            // Configurar toast
            toastMessage.textContent = message;
            toast.className = 'toast';
            
            if (type === 'error') {
                toast.classList.add('error');
                toast.querySelector('i').className = 'fas fa-exclamation-circle';
            } else if (type === 'warning') {
                toast.classList.add('warning');
                toast.querySelector('i').className = 'fas fa-exclamation-triangle';
            } else {
                toast.classList.add('success');
                toast.querySelector('i').className = 'fas fa-check-circle';
            }
            
            // Mostrar toast
            toast.classList.add('show');
            
            // Esconder após 3 segundos
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Função para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        // Função para formatar data para nome de arquivo
        function formatDateForFile(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // Função para formatar moeda
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }
    </script>
</body>
</html>